{% extends 'base.html' %}
{% block content %}
<div class="animate-fade-in">
  <div class="bg-gradient-to-r from-green-600 to-teal-600 text-white py-10 mb-8 rounded-2xl">
    <h1 class="text-3xl font-bold"><i class="fas fa-graduation-cap mr-2"></i>My Courses</h1>
    <p class="text-green-100">Manage your enrollments and view course information</p>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-600 dark:text-gray-400 text-sm">Enrolled</p>
          <p class="text-3xl font-bold text-green-600">{{ summary.enrolled_count }}</p>
        </div>
        <i class="fas fa-check-circle text-4xl text-green-600 opacity-20"></i>
      </div>
    </div>
    
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-600 dark:text-gray-400 text-sm">Waitlisted</p>
          <p class="text-3xl font-bold text-orange-600">{{ summary.waitlisted_count }}</p>
        </div>
        <i class="fas fa-clock text-4xl text-orange-600 opacity-20"></i>
      </div>
    </div>
    
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-600 dark:text-gray-400 text-sm">Total Credits</p>
          <p class="text-3xl font-bold text-indigo-600">{{ summary.total_credits }}</p>
        </div>
        <i class="fas fa-star text-4xl text-indigo-600 opacity-20"></i>
      </div>
    </div>
    
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-600 dark:text-gray-400 text-sm">GPA</p>
          <p class="text-3xl font-bold text-purple-600">{{ "%.2f"|format(summary.gpa) }}</p>
        </div>
        <i class="fas fa-chart-line text-4xl text-purple-600 opacity-20"></i>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="flex gap-4 mb-6">
    <a href="{{ url_for('student.browse') }}" class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
      <i class="fas fa-plus mr-2"></i>Add Courses
    </a>
    <a href="{{ url_for('student.schedule') }}" class="px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition">
      <i class="fas fa-calendar mr-2"></i>View Schedule
    </a>
  </div>

  <!-- Tabs -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
    <div class="border-b border-gray-200 dark:border-gray-700">
      <nav class="flex">
        <button onclick="showTab('current')" id="tab-current" class="tab-button active px-6 py-4 font-semibold border-b-2 border-indigo-600 text-indigo-600">
          Current ({{ current|length }})
        </button>
        <button onclick="showTab('waitlisted')" id="tab-waitlisted" class="tab-button px-6 py-4 font-semibold border-b-2 border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100">
          Waitlisted ({{ waitlisted|length }})
        </button>
        <button onclick="showTab('completed')" id="tab-completed" class="tab-button px-6 py-4 font-semibold border-b-2 border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100">
          Completed ({{ completed|length }})
        </button>
      </nav>
    </div>

    <!-- Current Enrollments -->
    <div id="content-current" class="tab-content p-6">
      {% if current %}
        <div class="space-y-4">
          {% for enrollment in current %}
          <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
            <div class="flex justify-between items-start">
              <div class="flex-1">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                  {{ enrollment.course_section.course.code }} - {{ enrollment.course_section.course.title }}
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-3">Section {{ enrollment.course_section.section_code }} • {{ enrollment.course_section.term }}</p>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                  <div>
                    <span class="text-gray-600 dark:text-gray-400">Instructor:</span>
                    <p class="font-medium text-gray-900 dark:text-white">
                      {{ enrollment.course_section.instructor.user.full_name if enrollment.course_section.instructor else 'TBA' }}
                    </p>
                  </div>
                  <div>
                    <span class="text-gray-600 dark:text-gray-400">Credits:</span>
                    <p class="font-medium text-gray-900 dark:text-white">{{ enrollment.course_section.course.credits }}</p>
                  </div>
                  <div>
                    <span class="text-gray-600 dark:text-gray-400">Mode:</span>
                    <p class="font-medium text-gray-900 dark:text-white">{{ enrollment.course_section.delivery_mode or 'In-Person' }}</p>
                  </div>
                  {% if enrollment.course_section.schedule %}
                  <div>
                    <span class="text-gray-600 dark:text-gray-400">Schedule:</span>
                    <p class="font-medium text-gray-900 dark:text-white">
                      {% if enrollment.course_section.schedule.days %}
                        {{ enrollment.course_section.schedule.days|join(', ') }}
                      {% else %}
                        TBA
                      {% endif %}
                    </p>
                  </div>
                  {% endif %}
                </div>
              </div>
              
              <div class="ml-4">
                <form method="post" action="{{ url_for('student.drop', enrollment_id=enrollment.id) }}" onsubmit="return confirm('Are you sure you want to drop this course?');">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                    <i class="fas fa-times mr-2"></i>Drop
                  </button>
                </form>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-12">
          <i class="fas fa-inbox text-5xl text-gray-400 mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No Current Enrollments</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-4">Start by browsing available courses</p>
          <a href="{{ url_for('student.browse') }}" class="inline-block px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
            <i class="fas fa-search mr-2"></i>Browse Courses
          </a>
        </div>
      {% endif %}
    </div>

    <!-- Waitlisted -->
    <div id="content-waitlisted" class="tab-content hidden p-6">
      {% if waitlisted %}
        <div class="space-y-4">
          {% for enrollment in waitlisted %}
          <div class="border border-orange-200 dark:border-orange-900 bg-orange-50 dark:bg-orange-900 bg-opacity-10 rounded-lg p-4">
            <div class="flex justify-between items-start">
              <div class="flex-1">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                  {{ enrollment.course_section.course.code }} - {{ enrollment.course_section.course.title }}
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-2">Section {{ enrollment.course_section.section_code }} • {{ enrollment.course_section.term }}</p>
                
                <div class="flex items-center gap-4 text-sm">
                  <span class="px-3 py-1 bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300 rounded-full font-semibold">
                    <i class="fas fa-clock mr-1"></i>Position: {{ enrollment.waitlist_position }}
                  </span>
                  <span class="text-gray-600 dark:text-gray-400">
                    <i class="fas fa-calendar mr-1"></i>Added: {{ enrollment.waitlisted_at.strftime('%b %d, %Y') if enrollment.waitlisted_at else 'N/A' }}
                  </span>
                </div>
              </div>
              
              <div class="ml-4">
                <form method="post" action="{{ url_for('student.drop', enrollment_id=enrollment.id) }}" onsubmit="return confirm('Remove yourself from the waitlist?');">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button type="submit" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                    <i class="fas fa-times mr-2"></i>Remove
                  </button>
                </form>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-12">
          <i class="fas fa-list text-5xl text-gray-400 mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No Waitlisted Courses</h3>
          <p class="text-gray-600 dark:text-gray-400">You'll be automatically enrolled when seats become available</p>
        </div>
      {% endif %}
    </div>

    <!-- Completed -->
    <div id="content-completed" class="tab-content hidden p-6">
      {% if completed %}
        <div class="space-y-4">
          {% for enrollment in completed %}
          <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
            <div class="flex justify-between items-start">
              <div class="flex-1">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                  {{ enrollment.course_section.course.code }} - {{ enrollment.course_section.course.title }}
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-2">Section {{ enrollment.course_section.section_code }} • {{ enrollment.course_section.term }}</p>
                
                <div class="flex items-center gap-4 text-sm">
                  {% if enrollment.grade %}
                    <span class="px-3 py-1 bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 rounded-full font-semibold">
                      Grade: {{ enrollment.grade }}
                    </span>
                    {% if enrollment.grade_points %}
                      <span class="text-gray-600 dark:text-gray-400">
                        {{ enrollment.grade_points }} points
                      </span>
                    {% endif %}
                  {% else %}
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-full">
                      Grade pending
                    </span>
                  {% endif %}
                  <span class="text-gray-600 dark:text-gray-400">
                    <i class="fas fa-star mr-1"></i>{{ enrollment.course_section.course.credits }} Credits
                  </span>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-12">
          <i class="fas fa-graduation-cap text-5xl text-gray-400 mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No Completed Courses</h3>
          <p class="text-gray-600 dark:text-gray-400">Your completed courses will appear here</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  function showTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
      content.classList.add('hidden');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.tab-button').forEach(button => {
      button.classList.remove('active', 'border-indigo-600', 'text-indigo-600');
      button.classList.add('border-transparent', 'text-gray-600', 'dark:text-gray-400');
    });
    
    // Show selected tab content
    document.getElementById(`content-${tabName}`).classList.remove('hidden');
    
    // Add active class to selected tab
    const activeTab = document.getElementById(`tab-${tabName}`);
    activeTab.classList.add('active', 'border-indigo-600', 'text-indigo-600');
    activeTab.classList.remove('border-transparent', 'text-gray-600', 'dark:text-gray-400');
  }
</script>
{% endblock %}
